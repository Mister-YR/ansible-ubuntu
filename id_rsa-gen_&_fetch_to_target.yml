---
- hosts: all
  gather_facts: true
  become: true
  ignore_errors: true

  vars:
    target_host:

  tasks:
  - name: gererate id_rsa.pub file
    tags: run
    shell: >
      ssh-keygen -q -b 2048 -t rsa -N "" -C "creating SSH" -f ~/.ssh/id_rsa
        creates="~/.ssh/id_rsa"

  - name: Fetch the keyfile from the node to master
      tags: run
      fetch: 
        src: "~/.ssh/id_rsa.pub"
        dest: "buffer/{{ansible_hostname}}-id_rsa.pub"
        flat: yes
